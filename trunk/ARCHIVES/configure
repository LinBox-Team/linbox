#!/bin/sh
###########################################################################
##  configure   Linbox library 
## Copyright (C) 1999, The Linbox Group.
###########################################################################

umask 002

ORIG="contributions"

usage() {
  echo "usage: configure [-i includedir] "
  echo "                 [ -h | -help ] "
  echo "  where:"
  echo "     -i           : location of your C++ include dir"
  echo "                    (default : \`pwd\`/include)"
  echo "     -h           : Produces this message"
  echo "  remark: each path needs to be absolute."
  exit 127
}


using() {
  echo "---     Linbox library setup    ---"
  echo "--- Include directory location     : $linincdir"
}

#defaults
linincdir=`pwd`/include

#
# Parsing arguments
#
getpar=no # next argument is a parameter

for i in $*
do
  if [ $getpar = no ]; then
    if [ "$i" = "-i" ]; then
      getpar=getinc
    elif [ "$i" = "-h" -o "$i" = "--h" -o "$i" = "-help" -o "$i" = "--help" ]; then
      usage >&2
    else
      echo "*** unrecognized parameter $i" >&2
      usage >&2
    fi
  else
    case $getpar in
      getinc)     linincdir="$i";;
   esac
   getpar=no
  fi
done

#
# args Verification
#

if [ ! -d "$linincdir" ]; then
  echo "The directory $linincdir seems not to exists." >&2
  echo "Trying to create it ..." >&2
  mkdir $linincdir
fi

using
echo ""
echo "Does this setup suit you ? (y/n) \c"
read answer
if [ "$answer" = "n" -o "$answer" = "no" -o "$answer" = "N" -o "$answer" = "NO" ]; then
    exit 127
fi
    

#######
# Generating config file
#######
cat > configure.status <<EOF
#----------------------------------------------------
# Linbox library configuration status
# ----------------------------------------------------
# ****************************************************************
# WARNING! This file has been automatically generated by configure
# `date`
# ****************************************************************
#
# executed command
$0 $*
#

EOF
using >> configure.status


\rm -f sedfile tmpfile.1 tmpfile
touch tmpfile.1
touch sedfile

echo "linincdir="\""$linincdir"\" >> tmpfile.1

sed 's/\//\\\//g' tmpfile.1 > tmpfile

echo "echo s/@LININCDIR@/\$linincdir/g >> sedfile" >> tmpfile

chmod +x tmpfile
./tmpfile

\rm -f Makefile.rules Make.listing
sed -f sedfile $(ORIG)/Makefile.rules.in > Makefile.rules
sed -f sedfile $(ORIG)/Make.listing.in > Make.listing
chmod a+x Make.listing

\rm -f sedfile tmpfile.1 tmpfile

echo ""
echo "Configuration completed. Please use 'gmake' to compile the library."

##################################################################
## Copyright (C) 1999, The Linbox Group.
##################################################################
