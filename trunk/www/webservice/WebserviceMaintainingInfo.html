<!-- Matthew Fendt Summer '07 to Winter'09
     Information about the setup of the LinBox Web service
-->


<html>
<head>
<title> Maintaining the LinBox Webservice</title>
<link rel="stylesheet" href="linbox.css" title="linbox" type="text/css">
</head>
<body>

<h1> Maintaining the LinBox Webservice</h1>

On this page I document exactly how the LinBox web service was
developed and how it may be updated and maintained.  If you have any further
questions, feel free to email me at matt.fendt@gmail.com.  Please prefix the
subject line of your email with [LINBOX]. <br>
-- Matthew Fendt, January 2009

<br>
<br>
The old version of this page can be found <a href="http://www.linalg.org/webservice/DevelopmentDocumentation.html">here</a>.<br><br>

<a name ="contents"><h2><u>Page Contents</u></h2></a>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#overview">
Overview</a><br>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#server">
Building the Server</a><br>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#queue">
Building the Middleman Service and Queue Client</a><br>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#running">
Running the Webservice</a><br>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#update">
Updating and Maintaining the Service</a><br>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#issues">
Current Issues and Concerns</a><br>

<br>
<br>



<a name="overview"><h2><u>Overview</u></h2></a> <br>
LinBox is a "C++ template library for exact,
high-performance linear algebra computation with dense, sparse, and structured
matrices over the integers and over finite fields."  <b>LinBox can be used to
perform massive matrix computations</b> that programs like Matlab and Maple 
could not solve.  Furthermore, LinBox is constantly being updated and improved,
with special considerations for potential users. <br> <br>

However, this power comes with a price.  It is not always practical or
desirable to download the entire LinBox library, as the entire download may
not be necessary for only a few computations.  Also, since LinBox is constantly
in flux, the users would need to stay up to date with the frequent downloads.
Finally, since LinBox is a "template library," it is not always easy
for the user to run a program and quickly get an answer.  This prompted the
need for another way of using LinBox. <br> <br>

The creation of a web service for LinBox <b> makes it easy to use the LinBox
library.</b>  A web service is "a software system designed to support 
interoperable Machine to Machine interaction over a network" (Wikipedia).  The web service
solves the above problems with LinBox.  First and foremost, the user <b> no
longer needs to download the entire LinBox library</b> to perform a 
computation.  He or she simply needs to install the client code that accesses
the web service. Second, the web service's copy of LinBox  will be able to be
updated without any worry from the user.  Finally, the web service provides
several different methods that the user can simply input the data and receive
an answer.
<br><br>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#contents">
Return to top</a><br>
<br>
<br>


<a name="overview"><h2><u>Overview</u></h2></a> <br>
The web service can be thought of in terms of three clouds:
<ul>
<li>  The first cloud consists of all of the user clients.  They are on various
machines, and have downloaded the client code that allows them to access the
LinBox webservice.  These clients make calls to a intermediate webservice
called a middleman, which enqueues their requests for processing.</li>
<li> The second cloud consists of two things running on the same machine.  The
first is the middleman webservice, which is called by the clients.  The second
is another client, called a "Queue Client," which processes the requests which
were added to the queue when the user clients called the middleman webservice.
This queue client then calls the actual LinBox webservice.</li>
<li> The final cloud consists of one or more servers on some number of machines.
These servers host the actual LinBox webservice that the queue client calls.
The answer is computed and given back to the queue client, which then gives
the answer back to the user client.</li>
</ul>

The purpose of the extra intermediate webservice and the queue is so that users
can asynchronously call the webservice, and their requests can be processed in
an orderly manner.  If the user was allowed to call the webservice directly
(which is how the webform works at this time), no other user could call the
service until the first call was finished processing.
<br><br>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#contents">
Return to top</a><br>
<br>
<br>

<a name="server"><h2><u>Building the Server</u></h2></a> <br>
A "server" is the computer on which the web service will be hosted.  
It is also where the LinBox library is installed and where the computations 
are done.  The following contains the step that were taken to install the server on hmrg.
<br><br>

<b>Some things to note:</b>
<ul>
  <li> Currently only configured for Fendt's directory on "hmrg.pc.cis.udel.edu"</li>
  <li> Web service resides in /home/fendt/apache-tomcat-6.0.18/webapps/
  axis2/WEB-INF/services </li>
  <li> Apache is currently listening on port 2000.  This is verified in
  <apache-dir>/WEB-INF/server.xml  The "Connector port" is set to 2000.  This
  is at line ~50. </li>
  <li> Apache startup/shutdown locations: <br>
      STARTUP: /home/fendt/apache-tomcat-6.0.18/bin/startup.sh <br>
      SHUTDOWN: /home/fendt/apache-tomcat-6.0.18/bin/shutdown.sh </li>
</ul>



<b>Requirements:</b>
<ul>
  <li> Apache Ant 1.7.0 </li> 
  <li> Apache Tomcat 6.0.18 </li>
  <li> Axis2 1.4.1 installed under Tomcat </li>
  <li> JDK version 1.6.0_07 </li>
  <li> SWIG version 1.3.31 (For updating LinBox functionality) </li>
  <li> LinBoxWebservice directory </li>
  <li> LinBox computational library itself</li>
</ul>

<b>Setup:</b>

<ol>
  <li>Install Ant, Tomcat, Axis2, and Java</li>
  <li>Set CATALINA_HOME to Tomcat directory (eg /home/fendt/apache-tomcat-6.0.18)</li>
  <li>Set AXIS2_HOME to Axis 2 directory (eg /home/fendt/axis2-1.4.1)</li>
  <li>Set ANT_HOME to Ant directory (eg /home/fendt/apache-ant-1.7.0)</li>
  <li>Set JAVA_HOME to Java directory (eg /usr/lib/jvm/java-6-sun)</li>
  <li>Make sure Apache is shut down with /home/fendt/apache-tomcat-6.0.18/bin/shutdown.sh</li>
  <li> Svn and configure the LinBox library.  This was done on hmrg.pc.cis.
udel.edu in the directory /home/fendt/linbox.  This is the copy of LinBox that
the web service will use. </li>
  <li> Copy the LinBoxWebservice directory, located at /home/fendt/LinBoxWebservice. </li>
  <li>In LinBoxWebservice directory, type "ant generate.service" to ready the
  service.</li>
  <li>Start up Apache with ./home/fendt/apache-tomcat-6.0.18/bin/startup.sh</li>
  <li>The web service is now installed in the "services" directory on Apache,
  is listening on port 2000, and ready for client calls.</li>
</ol>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#contents">
Return to top</a><br>
<br>
<br>




<a name="queue"><h2><u>Building the Middleman Service and the Queue Client</u></h2></a> <br>
Once the service is installed, you will need to generate the intermediate
webservice and the queue client.
<ol>
  <li>Make sure that Apache is started up on hmrg.</li>
	<li>Generate the middleman web service on linalg with ant generate.middleman</li>
	<li>Generate the queue client on linalg with ant generate.queue.client</li>
<li>The queue client is now ready to be run.</li>
</ol>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#contents">
Return to top</a><br>
<br>
<br>



<a name="running"><h2><u>Running the Webservice</u></h2></a> <br>

Once the service has been installed, you can choose to run either the stand
alone client or the dependent client.  To install and learn more about these
client, <a href="http://www.linalg.org/webservice/UsingCommandLine.html">
click here</a>.<br><br>
<b>To run the dependent client:</b>
<ol>
<li>Make sure the service is installed.</li>
<li>Start up Apache.</li>
<li>The dependent client can now be called.</li>
</ol>

<b>To run the stand alone client:</b>
<ol>
<li>Make sure that the service and middleman have been generated, as above.</li>
	<li>Start up RMI on linalg with /usr/jdk/jdk1.5.0_15/bin/rmiregistry</li>
	<li>Start the queue client on linalg with ant run.queue.client</li>
	<li>Start the queue client on hmrg with ant run.user.client</li>
	<li>You can now make web service calls on hmrg with the user client.</li>
</ol>


<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#contents">
Return to top</a><br>
<br>
<br>


<a name="update"><h2><u>Updating and Maintaining the Service</u></h2></a> <br>
<b> Compilation of LinBox Functional .so From Default Directory on Hmrg</b>
<ol>
  <li>cd to /home/fendt/LinBoxWebservice/src/samples/quickstart/service/adb/xsd</li>
  <li>In makefile: Make sure that the path of the LinBox library is correct.  
  It is currently -I/home/fendt/linbox </li>
  <li>Type "make liblinboxfunctions.so"</li>
  <li>The .so should be ready to be used.</li>
</ol>

<b> Relocating the LinBox Function .so</b>
<ol>
  <li>In makefile, set the path to the LinBox library, eg "-I/home/fendt/linbox"</li>
  <li>Follow compilation instructions as above</li>
</ol>

<b>To Add Additional LinBox Functionality</b>
<ol>
  <li>In linboxfunctions.i: Add both the computation function, eg <ul><li>extern bool det(std::istream& matrix_in, std::ostream& det_out)</li></ul> and the
   i/o function, eg <ul><li>extern char* detFiles(char *matfile)</li></ul> both inside and 
   outside the %{ ... %} block</li>

  <li>In linboxfunctions.C: Update the "Currently supported methods" section,
   #include the appropriate files from the linbox library, and add the
   appropriate "file" variable.  Add new computation and i/o function.</li>

  <li>Run the .i file through SWIG (swig -java -c++ -package 
   samples.quickstart.service.adb.xsd linboxfunctions.i).
   This will generate the necessary interfacing for the C++ linbox code to work
   with the Java web service.</li>

  <li>Type "make liblinboxfunctions.so"</li>

  <li>The .so should be ready to be used.  Note that if only "linboxfunctions.C" needs to be changed, step 3 can be ommited.</li>

  <li>The resources/META-INF/services.xml file needs to be updated; add a new "operation" tag to the file.</li>

  <li>The service should be reinstalled on hmrg so that the new service is added.</li>
  <li>The client code also needs to be updated to accomidate the new functionality.</li>
</ol>


<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#contents">
Return to top</a><br>
<br>
<br>


<a name="issues"><h2><u>Current Issues and Concerns</u></h2></a>
<ul>
<li>
At the end of the summer, the hmrg computer was updated to Ubuntu, and this caused some things to stop 
working in the service.  During this winter, I fixed these issues, and both the queued command line 
server and the web client are running.</li>

<li>
The wrapper code for LinBox no longer writes the answer to a file and then immediately opens and sends back the answer.  It writes directly to a ostringstream instead.</li>

<li>
Axis2 was upgraded to version 1.4.  This helped with the issue above, but introduced a new warning:
<br>
<b>[WARN] Unable to generate EPR for the transport : http</b>
<br>
This is seen during the wsdl generation of the middleman and TransferAgent services.  It is uncertain that this warning has any effect.</li>

<li>
A warning:
<br>
<b>     [java] log4j:WARN No appenders could be found for logger (org.apache.axis2.description.AxisService).
<br>    [java] log4j:WARN Please initialize the log4j system properly.</b>
<br>
occured when running the queue and user clients.  This was solved by adding the directory containing a log4j file to the runtime directory in the Ant file.</li>

<li>
The TransferAgentMiddleman web service and the queue client were moved over to linalg.org from hmrg.  Everything still works.
<li>

<li>
Sometimes when the answer is too larged (>50 digits or so), the service will return a null pointer instead of the answer.  This does not cause the service to crash, nor does it happen all of the time.  The problem was traced to a specific area in the Swig auto-generated code.  Perhaps Java is garbage collecting the memory before it is returned.  This is a significant bug.
</li>
</ul>

<a href="http://www.linalg.org/webservice/WebserviceMaintainingInfo.html#contents">
Return to top</a><br><br>

<a href="http://www.linalg.org/servers.html">Return to server page</a><br><br>
<br>
</body>
</html>


